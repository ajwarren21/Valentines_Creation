{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Andrew/Desktop/VDProject/Valentines_Creation/valentine-gift/lib/prisma.js"],"sourcesContent":["// lib/prisma.js\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { PrismaPg } from '@prisma/adapter-pg';\r\nimport \"dotenv/config\"; // ensure env vars are loaded\r\n\r\n// const globalForPrisma = globalThis;\r\n\r\nconst connectionString = process.env.DATABASE_URL;\r\nconst adapter = new PrismaPg({ connectionString });\r\nconst prisma = new PrismaClient({ adapter });\r\nexport {prisma};\r\n\r\n// export const prisma =\r\n//   globalForPrisma.prisma ||\r\n//   new PrismaClient({\r\n//     log: [\"query\"], // optional\r\n//     // adapter: \"postgresql\", // <--- REQUIRED in Prisma 7 for local Postgres\r\n//   });\r\n\r\n// if (process.env.NODE_ENV !== \"production\") {\r\n//   globalForPrisma.prisma = prisma;\r\n// }\r\n"],"names":[],"mappings":";;;;AAAA,gBAAgB;AAChB;AACA;AACA,sOAAwB,6BAA6B;;;;;;;;AAErD,sCAAsC;AAEtC,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AACjD,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAAE;AAAiB;AAChD,MAAM,SAAS,IAAI,sMAAY,CAAC;IAAE;AAAQ;;CAG1C,wBAAwB;CACxB,8BAA8B;CAC9B,uBAAuB;CACvB,kCAAkC;CAClC,gFAAgF;CAChF,QAAQ;CAER,+CAA+C;CAC/C,qCAAqC;CACrC,IAAI"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Andrew/Desktop/VDProject/Valentines_Creation/valentine-gift/src/app/api/gift/%5Bslug%5D/route.js"],"sourcesContent":["// app/api/gift/[slug]/route.js\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/../lib/prisma\";\r\n\r\n// GET - Retrieve gift details\r\nexport async function GET(req, context) {\r\n  try {\r\n    const { slug } = await context.params;\r\n\r\n    const gift = await prisma.gift.findUnique({\r\n      where: { slug },\r\n    });\r\n\r\n    if (!gift) {\r\n      return NextResponse.json(\r\n        { error: \"Gift not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(gift);\r\n  } catch (error) {\r\n    console.error(\"Error fetching gift:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch gift\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PATCH - Accept/fulfill gift\r\nexport async function PATCH(req, context) {\r\n  try {\r\n    const { slug } = await context.params;\r\n\r\n    const gift = await prisma.gift.findUnique({\r\n      where: { slug },\r\n    });\r\n\r\n    if (!gift) {\r\n      return NextResponse.json(\r\n        { error: \"Gift not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (gift.fulfilled) {\r\n      return NextResponse.json(\r\n        { error: \"Gift already fulfilled\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Fulfill the gift based on type\r\n    const fulfillmentResult = await fulfillGift(gift);\r\n\r\n    // Update gift as fulfilled\r\n    await prisma.gift.update({\r\n      where: { slug },\r\n      data: {\r\n        fulfilled: true,\r\n        fulfilledAt: new Date(),\r\n        fulfillmentData: fulfillmentResult,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ fulfillmentResult });\r\n  } catch (error) {\r\n    console.error(\"Error fulfilling gift:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to fulfill gift\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// Fulfillment logic based on gift type\r\nasync function fulfillGift(gift) {\r\n  switch (gift.giftType) {\r\n    case \"COFFEE\":\r\n      return fulfillCoffee(gift);\r\n    \r\n    case \"GIFTCARD\":\r\n      return fulfillGiftCard(gift);\r\n    \r\n    case \"CHOCOLATES\":\r\n      return fulfillChocolates(gift);\r\n    \r\n    case \"FLOWERS\":\r\n      return fulfillFlowers(gift);\r\n    \r\n    default:\r\n      return { message: \"Gift fulfilled!\" };\r\n  }\r\n}\r\n\r\n// Coffee fulfillment - could integrate with Starbucks API or use pre-purchased codes\r\nasync function fulfillCoffee(gift) {\r\n  // Option 1: Return a pre-purchased Starbucks eGift link\r\n  // const code = await getNextAvailableCoffeeCode();\r\n  // return `https://www.starbucks.com/gift/redeem/${code}`;\r\n\r\n  // Option 2: Placeholder for now\r\n  return \"https://www.starbucks.com/gift\"; // Replace with actual fulfillment\r\n}\r\n\r\n// Gift card fulfillment\r\nasync function fulfillGiftCard(gift) {\r\n  const config = gift.giftConfig;\r\n  \r\n  // Get next available gift card code from database\r\n  // In production, you'd query a table of pre-purchased codes\r\n  const code = await getNextGiftCardCode(config.brand, config.amount);\r\n  \r\n  return {\r\n    redemptionCode: code || \"SAMPLE-GIFT-CODE-1234\",\r\n    brand: config.brand || \"Amazon\",\r\n    amount: config.amount || 25,\r\n    instructions: `Redeem this code at ${config.brand || \"Amazon\"}.com`,\r\n  };\r\n}\r\n\r\n// Chocolates fulfillment\r\nasync function fulfillChocolates(gift) {\r\n  // Could integrate with a fulfillment service like Goldbelly, Harry & David, etc.\r\n  // For now, return a tracking link placeholder\r\n  return \"https://www.godiva.com/track/your-order\";\r\n}\r\n\r\n// Flowers fulfillment\r\nasync function fulfillFlowers(gift) {\r\n  // Could integrate with 1-800-Flowers API\r\n  return \"https://www.1800flowers.com/track\";\r\n}\r\n\r\n// Helper function to get next available gift card code\r\n// In production, this would query your database for unused codes\r\nasync function getNextGiftCardCode(brand, amount) {\r\n  // Example query (you'd need a GiftCardCode model in Prisma):\r\n  // const code = await prisma.giftCardCode.findFirst({\r\n  //   where: {\r\n  //     brand,\r\n  //     amount,\r\n  //     used: false,\r\n  //   },\r\n  // });\r\n  // \r\n  // if (code) {\r\n  //   await prisma.giftCardCode.update({\r\n  //     where: { id: code.id },\r\n  //     data: { used: true },\r\n  //   });\r\n  //   return code.code;\r\n  // }\r\n  \r\n  // For now, return a sample code\r\n  return `${brand.toUpperCase()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\r\n}"],"names":[],"mappings":";;;;;;AAAA,+BAA+B;AAC/B;AACA;;;;;;;AAGO,eAAe,IAAI,GAAG,EAAE,OAAO;IACpC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,MAAM;QAErC,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE;YAAK;QAChB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,MAAM,GAAG,EAAE,OAAO;IACtC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,MAAM;QAErC,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE;YAAK;QAChB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,KAAK,SAAS,EAAE;YAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iCAAiC;QACjC,MAAM,oBAAoB,MAAM,YAAY;QAE5C,2BAA2B;QAC3B,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACvB,OAAO;gBAAE;YAAK;YACd,MAAM;gBACJ,WAAW;gBACX,aAAa,IAAI;gBACjB,iBAAiB;YACnB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAkB;IAC/C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,uCAAuC;AACvC,eAAe,YAAY,IAAI;IAC7B,OAAQ,KAAK,QAAQ;QACnB,KAAK;YACH,OAAO,cAAc;QAEvB,KAAK;YACH,OAAO,gBAAgB;QAEzB,KAAK;YACH,OAAO,kBAAkB;QAE3B,KAAK;YACH,OAAO,eAAe;QAExB;YACE,OAAO;gBAAE,SAAS;YAAkB;IACxC;AACF;AAEA,qFAAqF;AACrF,eAAe,cAAc,IAAI;IAC/B,wDAAwD;IACxD,mDAAmD;IACnD,0DAA0D;IAE1D,gCAAgC;IAChC,OAAO,kCAAkC,kCAAkC;AAC7E;AAEA,wBAAwB;AACxB,eAAe,gBAAgB,IAAI;IACjC,MAAM,SAAS,KAAK,UAAU;IAE9B,kDAAkD;IAClD,4DAA4D;IAC5D,MAAM,OAAO,MAAM,oBAAoB,OAAO,KAAK,EAAE,OAAO,MAAM;IAElE,OAAO;QACL,gBAAgB,QAAQ;QACxB,OAAO,OAAO,KAAK,IAAI;QACvB,QAAQ,OAAO,MAAM,IAAI;QACzB,cAAc,CAAC,oBAAoB,EAAE,OAAO,KAAK,IAAI,SAAS,IAAI,CAAC;IACrE;AACF;AAEA,yBAAyB;AACzB,eAAe,kBAAkB,IAAI;IACnC,iFAAiF;IACjF,8CAA8C;IAC9C,OAAO;AACT;AAEA,sBAAsB;AACtB,eAAe,eAAe,IAAI;IAChC,yCAAyC;IACzC,OAAO;AACT;AAEA,uDAAuD;AACvD,iEAAiE;AACjE,eAAe,oBAAoB,KAAK,EAAE,MAAM;IAC9C,6DAA6D;IAC7D,qDAAqD;IACrD,aAAa;IACb,aAAa;IACb,cAAc;IACd,mBAAmB;IACnB,OAAO;IACP,MAAM;IACN,GAAG;IACH,cAAc;IACd,uCAAuC;IACvC,8BAA8B;IAC9B,4BAA4B;IAC5B,QAAQ;IACR,sBAAsB;IACtB,IAAI;IAEJ,gCAAgC;IAChC,OAAO,GAAG,MAAM,WAAW,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,GAAG,WAAW,IAAI;AAC1F"}}]
}